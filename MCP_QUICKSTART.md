# Быстрый старт с MCP для CRM1

## Что такое MCP?

Model Context Protocol (MCP) — это открытый протокол, позволяющий AI-ассистентам безопасно взаимодействовать с внешними источниками данных и инструментами.

## Установка

1. **Установите зависимости:**
   ```bash
   npm install
   ```

2. **Настройте переменные окружения:**
   
   Создайте файл `.env.local`:
   ```env
   DB_USER=your_database_user
   DB_PASSWORD=your_database_password
   DB_SERVER=your_database_server
   DB_NAME=your_database_name
   DB_PORT=1433
   ```

3. **Проверьте структуру MCP сервера:**
   ```bash
   npx tsx src/mcp/test-structure.ts
   ```

## Использование с Claude Desktop

1. **Найдите конфигурационный файл:**
   - macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
   - Windows: `%APPDATA%\Claude\claude_desktop_config.json`

2. **Добавьте конфигурацию:**
   ```json
   {
     "mcpServers": {
       "crm1": {
         "command": "node",
         "args": [
           "--loader",
           "tsx",
           "/absolute/path/to/crm1/src/mcp/server.ts"
         ],
         "env": {
           "DB_USER": "your_user",
           "DB_PASSWORD": "your_password",
           "DB_SERVER": "your_server",
           "DB_NAME": "your_database",
           "DB_PORT": "1433"
         }
       }
     }
   }
   ```

3. **Перезапустите Claude Desktop**

## Доступные команды

### Задачи
- "Покажи список задач"
- "Найди задачу про интеграцию API"
- "Покажи подзадачи для задачи 42"
- "Покажи историю изменений задачи 15"

### Клиенты
- "Покажи всех клиентов"
- "Найди клиента Иванов"
- "Покажи информацию о клиенте 5"

### Проекты
- "Покажи все проекты"
- "Найди проект CRM"
- "Покажи задачи проекта 3"

### Сотрудники
- "Покажи всех сотрудников"
- "Найди сотрудника по должности разработчик"

## Примеры запросов

### Анализ задач проекта
```
Используй инструмент project_get_tasks для проекта 1 и проанализируй 
распределение задач по статусам
```

### Поиск активных задач
```
Покажи все задачи со статусом "В работе" и проанализируй их приоритеты
```

### Просмотр клиентской базы
```
Покажи последних 10 клиентов и их контактную информацию
```

## Отладка

Если что-то не работает:

1. **Проверьте логи:**
   - Логи MCP сервера выводятся в stderr
   - Проверьте консоль Claude Desktop на наличие ошибок

2. **Проверьте подключение к БД:**
   ```bash
   # Проверьте переменные окружения
   echo $DB_USER $DB_SERVER $DB_NAME
   ```

3. **Проверьте структуру:**
   ```bash
   npx tsx src/mcp/test-structure.ts
   ```

## Ограничения текущей версии

- ❌ Нет создания/изменения данных (только чтение)
- ❌ Нет аутентификации пользователей
- ❌ Нет rate limiting

## Дополнительная информация

См. [doc/MCP_README.md](../doc/MCP_README.md) для полной документации.
