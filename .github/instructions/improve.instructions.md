---
applyTo: '**'
---
Provide project context and coding guidelines that AI should follow when generating code, answering questions, or reviewing changes.Контекст: Next.js 15 (App Router), MSSQL, server actions. Цель: постепенно повышать безопасность и качество кода без ломки API.

Общие правила:
- Отвечай на русском, предлагай минимальные атомарные правки с пояснением «зачем».
- Сохраняй типы (TS strict), не отключай проверки. Избегай лишнего рефакторинга.

Приоритетные улучшения (выполняй постепенно, небольшими шагами):
1) Сессии: заменить куку userId на подписанную/зашифрованную сессию (например iron-session или JWT с подписью); обновить middleware и места чтения.
2) Логин: убрать сравнение паролей в открытом виде; при первом успешном входе мигрировать пароль на bcrypt и убрать легаси.
3) MSSQL: включить TLS в проде (encrypt: true, валидный сертификат).
4) Файлы: валидация типа/размера, хранение вне public; раздача через защищённый endpoint с проверкой прав.
5) Качество: включить ошибки TS/Eslint в сборке; при изменениях исправлять нарушения.
6) Безопасность: добавить rate limiting на логин и базовую защиту от bruteforce.

Стратегия:
- Для каждого пункта: предложи план из 2–4 маленьких коммитов/PR.
- Покажи диффы для затронутых файлов, SQL-миграции клади в /sql.
- Сохраняй текущее поведение UI; добавляй проверки 400/403/500 там, где это уместно.