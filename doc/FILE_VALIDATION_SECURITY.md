# üõ°Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ - –ó–∞—â–∏—Ç–∞ –æ—Ç RCE

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### **1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–∏—Ä—É–µ–º—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π** 
–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ **60+ –æ–ø–∞—Å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π**, –≤–∫–ª—é—á–∞—è:
- Windows: `.exe`, `.dll`, `.bat`, `.cmd`, `.ps1`, `.msi`, `.scr`
- Linux: `.sh`, `.bash`, `.run`, `.bin`, `.appimage`
- Java: `.jar`, `.war`, `.class`
- –í–µ–±: `.php`, `.asp`, `.aspx`, `.js`, `.jsx`, `.ts`
- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥: `.py`, `.rb`, `.pl`, `.c`, `.cpp`, `.pas` ‚ö†Ô∏è (–∫–∞–∫ —É –≤–∞—Å!)
- –î—Ä—É–≥–∏–µ: `.lnk`, `.vbs`, `.hta`, `.iso`

### **2. –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π**
```typescript
// –ë–õ–û–ö–ò–†–£–ï–¢: file.pdf.exe, document.docx.bat
if (parts.length > 2) {
  for (let i = 1; i < parts.length; i++) {
    if (BLOCKED_EXTENSIONS.includes(`.${parts[i]}`)) {
      return true; // –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û
    }
  }
}
```

### **3. –ó–∞—â–∏—Ç–∞ –æ—Ç Null Byte Injection**
```typescript
// –ë–õ–û–ö–ò–†–£–ï–¢: file.pdf%00.exe, file.pdf\0.exe
if (fileName.includes('\0') || fileName.includes('%00')) {
  return true; // –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û
}
```

### **4. –£—Å–∏–ª–µ–Ω–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤**
```typescript
// –ë–´–õ–û: file../../../etc/passwd
// –°–¢–ê–õ–û: file_________etc_passwd

baseName = baseName
  .replace(/\.\./g, '')              // Path traversal
  .replace(/[<>:"|?*\x00-\x1f]/g, '_') // –û–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
  .replace(/^\.+/, '')               // –°–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã (.htaccess)
  .replace(/\s+/g, '_')              // –ü—Ä–æ–±–µ–ª—ã
```

### **5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö**
```typescript
// –°–∫–∞–Ω–∏—Ä—É–µ—Ç .txt, .csv, .js –Ω–∞ –Ω–∞–ª–∏—á–∏–µ:
const dangerousPatterns = [
  /<script\b/i,        // JavaScript
  /eval\s*\(/i,        // eval()
  /exec\s*\(/i,        // command execution
  /shell_exec/i,       // PHP shell
  /base64_decode/i,    // –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è
];
```

### **6. –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```typescript
// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è validateFileComprehensive():
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME-—Ç–∏–ø–∞
// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
// 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ magic bytes (—Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
// 4. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
// 5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∑–æ–∫
```

---

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### [fileValidation.ts](../src/lib/fileValidation.ts)
- ‚úÖ 60+ –±–ª–æ–∫–∏—Ä—É–µ–º—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚úÖ Null byte injection –∑–∞—â–∏—Ç–∞
- ‚úÖ –£—Å–∏–ª–µ–Ω–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ `validateFileComprehensive()` - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### [uploadImage.ts](../src/app/tasks/views/project/actions/uploadImage.ts)
```typescript
// –ë–´–õ–û:
if (!allowedTypes.includes(file.type)) { ... }

// –°–¢–ê–õ–û:
const validation = await validateFileComprehensive(file, 'image', 5 * 1024 * 1024);
if (!validation.valid) {
  console.warn(`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${file.name} –æ—Ç ${currentUser.id}`);
  return { success: false, message: validation.error };
}
```

### [uploadDocument.ts](../src/app/tasks/views/project/actions/uploadDocument.ts)
```typescript
// –°–¢–ê–õ–û:
const validation = await validateFileComprehensive(file, 'document', 50 * 1024 * 1024);
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

### **SQL —Å–∫—Ä–∏–ø—Ç:** [security_check_files.sql](../sql/security_check_files.sql)

```sql
-- 1. –ù–∞–π—Ç–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
SELECT * FROM ProjectDocuments
WHERE originalName LIKE '%.exe' 
   OR originalName LIKE '%.sh'
   OR originalName LIKE '%.pas'; -- ‚ö†Ô∏è –ö–∞–∫ —É –≤–∞—Å –±—ã–ª –Ω–∞–π–¥–µ–Ω!

-- 2. –ù–∞–π—Ç–∏ –¥–≤–æ–π–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
WHERE originalName LIKE '%.%.%';

-- 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤
SELECT extension, COUNT(*) FROM ProjectDocuments
GROUP BY extension;
```

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

| –ê—Ç–∞–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|-------|----|----- |
| **RCE (–º–∞–π–Ω–µ—Ä.exe)** | ‚ùå –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è | ‚úÖ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** |
| **–î–≤–æ–π–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (file.pdf.exe)** | ‚ùå –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è | ‚úÖ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** |
| **Null byte (file.pdf%00.exe)** | ‚ùå –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è | ‚úÖ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** |
| **Path traversal (../../etc/passwd)** | ‚ùå –í–æ–∑–º–æ–∂–Ω–æ | ‚úÖ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** |
| **MIME –ø–æ–¥–¥–µ–ª–∫–∞ (.exe ‚Üí image/png)** | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç | ‚úÖ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** (magic bytes) |
| **XSS –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö** | ‚ùå –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | ‚úÖ **–°–ö–ê–ù–ò–†–£–ï–¢–°–Ø** |
| **–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (.pas, .py, .php)** | ‚ùå –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è | ‚úÖ **–ë–õ–û–ö–ò–†–û–í–ê–ù–û** |

---

## üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. **–¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ .exe**
```typescript
const file = new File([buffer], 'miner.exe', { type: 'application/x-msdownload' });
const result = await validateFileComprehensive(file, 'document');
// –†–µ–∑—É–ª—å—Ç–∞—Ç: { valid: false, error: '–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–∞' }
```

### 2. **–¢–µ—Å—Ç –¥–≤–æ–π–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**
```typescript
const file = new File([buffer], 'document.pdf.exe', { type: 'application/pdf' });
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –ë–õ–û–ö–ò–†–û–í–ê–ù–û ‚úÖ
```

### 3. **–¢–µ—Å—Ç MIME –ø–æ–¥–¥–µ–ª–∫–∏**
```typescript
const file = new File([exe_bytes], 'image.png', { type: 'image/png' });
// Magic bytes –ø—Ä–æ–≤–µ—Ä–∫–∞: –ë–õ–û–ö–ò–†–û–í–ê–ù–û ‚úÖ
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### **–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç
sqlcmd -S your-server -d MizerCRM -i sql/security_check_files.sql
```

### **–®–∞–≥ 2: –£–¥–∞–ª–∏—Ç–µ –æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–π–ª—ã**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã SELECT –∑–∞–ø—Ä–æ—Å–æ–≤
-- –ó–∞—Ç–µ–º —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ DELETE –≤ —Å–∫—Ä–∏–ø—Ç–µ
```

### **–®–∞–≥ 3: –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª—ã —Å –¥–∏—Å–∫–∞**
```powershell
# Windows
Get-ChildItem -Path "public\media" -Recurse -Include *.exe,*.dll,*.sh,*.pas | 
  Select-Object FullName, Length, LastWriteTime

# Linux
find public/media -type f \( -name "*.exe" -o -name "*.sh" -o -name "*.pas" \) -ls
```

### **–®–∞–≥ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```
‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞: miner.exe –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 5
```

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–µ–≥—É–ª—è—Ä–Ω–æ!

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏:** üî¥ **10/10** ‚Üí üü¢ **1/10**

**–ë—ã–ª–æ:**
- ‚ùå –õ—é–±—ã–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- ‚ùå –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME (–ª–µ–≥–∫–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å)
- ‚ùå –ú–∞–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–°—Ç–∞–ª–æ:**
- ‚úÖ 60+ –æ–ø–∞—Å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ Magic bytes –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ–±—Ö–æ–¥–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫
- ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–π–Ω–µ—Ä–∞ –ù–ï–í–û–ó–ú–û–ñ–ù–ê**

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–≠—Ç–∞ –∑–∞—â–∏—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞!** –ë–µ–∑ –Ω–µ—ë –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–π–Ω–µ—Ä ‚Üí –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU 100%
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å backdoor ‚Üí –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å ransomware ‚Üí —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–©–ò–©–ï–ù–û**
