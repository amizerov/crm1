# Drag & Drop —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –ø–æ—Ä—è–¥–∫–∞ –∑–∞–¥–∞—á –≤ Kanban

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI**
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É, –æ–Ω–∞ **—Å—Ä–∞–∑—É** –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ –≤ UI, –∞ –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### 2. **–°–∫–≤–æ–∑–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤**
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –∏ –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á –≤ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–∫–≤–æ–∑–Ω—É—é –Ω—É–º–µ—Ä–∞—Ü–∏—é 0, 1, 2, 3... –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤.

### 3. **–í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**
- **–°–∏–Ω—è—è –ª–∏–Ω–∏—è** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –≤—Å—Ç–∞–≤–∫–∏ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
- **–ó–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞ –∏ —Å–ø–∏–Ω–Ω–µ—Ä** –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 30%** –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏
```typescript
// –î–æ: [0, 1, 2, 3, 4]
// –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∑–∞–¥–∞—á—É —Å –ø–æ–∑–∏—Ü–∏–∏ 1 –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 3
// –ü–æ—Å–ª–µ: [0, 2, 3, 1, 4] -> –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤–∫–∞ -> [0, 1, 2, 3, 4]
```

### –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏
```typescript
// –ö–æ–ª–æ–Ω–∫–∞ A: [0, 1, 2, 3]
// –ö–æ–ª–æ–Ω–∫–∞ B: [0, 1, 2]
// –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∑–∞–¥–∞—á—É –∏–∑ A(1) –≤ B(1)
// –ö–æ–ª–æ–Ω–∫–∞ A: [0, 2, 3] -> –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤–∫–∞ -> [0, 1, 2]
// –ö–æ–ª–æ–Ω–∫–∞ B: [0, NEW, 1, 2] -> –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤–∫–∞ -> [0, 1, 2, 3]
```

## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ orderInStatus (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ)
```sql
ALTER TABLE Task ADD orderInStatus INT DEFAULT 0;
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å orderInStatus –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
sql/initialize_orderInStatus.sql
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –î–û –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü–µ—Ä–µ–Ω—É–º–µ—Ä–æ–≤—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ—Ä–Ω–µ–≤—ã–µ –∑–∞–¥–∞—á–∏ (0, 1, 2, 3...)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ü–û–°–õ–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–∞—Ç—É—Å—É

## –§–∞–π–ª—ã

### Backend
- `src/app/tasks/actions/updateTaskOrder.ts` - Server Action –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
- `src/app/tasks/actions/getTasks.ts` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ orderInStatus

### Frontend
- `src/app/tasks/views/desk/KanbanBoard.tsx` - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç Kanban —Å drag & drop
  - `getInsertPosition()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤—Å—Ç–∞–≤–∫–∏
  - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º –ø–æ—Ä—è–¥–∫–∞
  - –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤—Å—Ç–∞–≤–∫–∏

### SQL
- `sql/initialize_orderInStatus.sql` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
üéØ Drag & Drop: { taskId, oldStatusId, newStatusId, oldOrder, targetPosition }
üì§ Calling updateTaskOrder
üîß updateTaskOrder START
üìä Current task state
üîÑ Moving between columns / ‚ÜîÔ∏è Moving within same column
üìç Shifting tasks
üíæ Moving/Updating task
üìù Renumbering
üîç Verifying numbering integrity
  üìä Checking status
  ‚úèÔ∏è Renumbered task (–µ—Å–ª–∏ –±—ã–ª–∏ –ø—Ä–æ–ø—É—Å–∫–∏)
‚úÖ updateTaskOrder completed successfully
```

## –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤

–ö–æ–≥–¥–∞ –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å `console.log` –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã –∫–æ–¥–∞:

**–í KanbanBoard.tsx:**
- –°—Ç—Ä–æ–∫–∏ —Å `console.log('üéØ Drag & Drop'...`
- –°—Ç—Ä–æ–∫–∏ —Å `console.log('üì§ Calling updateTaskOrder'...`
- –°—Ç—Ä–æ–∫–∏ —Å `console.log('üì• updateTaskOrder result'...`

**–í updateTaskOrder.ts:**
- –í—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å `console.log`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏** - –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å—Ä–∞–∑—É –≤—Å—Ç–∞—Ç—å –Ω–∞ –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ
2. **–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏** - –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö** - –Ω—É–º–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫–≤–æ–∑–Ω–æ–π –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤
4. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** - –ø–æ—Ä—è–¥–æ–∫ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
SELECT statusId, id, taskName, orderInStatus
FROM Task
WHERE parentId IS NULL
ORDER BY statusId, orderInStatus;
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ä—Ç–æ—á–∫–∞ "–ø—Ä—ã–≥–∞–µ—Ç" –ø–æ—Å–ª–µ drop
**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º –ø–æ—Ä—è–¥–∫–∞ –≤—Å–µ—Ö –∑–∞–¥–∞—á

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–ø—É—Å–∫–∏ –≤ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä–æ–µ –º–µ—Å—Ç–æ
**–†–µ—à–µ–Ω–∏–µ:** –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ë–î

## Performance

- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: **<10ms** (—Ç–æ–ª—å–∫–æ UI)
- –ó–∞–ø—Ä–æ—Å –∫ –ë–î: **~100-300ms** (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–¥–∞—á)
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏—è: **~50-150ms** –Ω–∞ —Å—Ç–∞—Ç—É—Å

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∂–¥–µ—Ç - –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ! üöÄ
