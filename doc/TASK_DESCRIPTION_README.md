# TaskDescription Component

## Описание
Компонент TaskDescription.tsx предоставляет модальное окно для просмотра и редактирования описания задач с использованием богатого текстового редактора TipTap Editor.

## Функциональность

### 1. Краткое отображение в карточке задачи
- Показывает краткое описание без HTML тегов (до 200 символов)
- SVG иконка раскрытия для открытия модального окна (как в описании проекта)
- Умная обработка пустого описания и HTML тегов

### 2. Модальное окно с полнофункциональным редактором
- Заголовок показывает название задачи
- Полный TipTap Editor с форматированием текста
- Загрузка изображений из файловой системы
- Медиатека для задач с изображениями
- Поддержка drag & drop изображений
- Изменение размера изображений
- Режимы inline/float для изображений

### 3. Медиатека задач
- Отдельная медиатека для каждой задачи
- Структура папок: `public/media/p{projectId}/t{taskId}/`
- Загрузка, просмотр и удаление изображений
- Предпросмотр изображений
- Информация о размере файлов

## Структура файлов

### Компоненты
- `TaskDescription.tsx` - основной компонент с модальным окном
- `TaskMediaLibrary.tsx` - медиатека для задач
- `TiptapEditor.tsx` - обновлен для поддержки задач

### Server Actions
- `updateTaskDescription.ts` - сохранение описания задачи
- `uploadTaskImage.ts` - загрузка изображений для задач
- `taskMediaLibrary.ts` - управление медиатекой задач

## Использование

### В TaskDetailsTab.tsx
```tsx
<TaskDescription
  taskId={task.id}
  projectId={task.projectId || 0}
  description={task.description || ''}
  isEditable={true}
/>
```

### Параметры TaskDescription
- `taskId` - ID задачи
- `projectId` - ID проекта (для организации медиатеки)
- `taskName` - название задачи (для заголовка модального окна)
- `description` - текущее описание задачи (HTML)
- `onDescriptionUpdate?` - callback при обновлении описания
- `isEditable` - разрешить ли редактирование (по умолчанию true)

## Новая структура папок

```
public/
  media/
    p{projectId}/          # Проект
      image1.jpg          # Изображения проекта
      t{taskId}/          # Задача
        doc1.pdf          # Документы задачи
        image1.jpg        # Изображения задачи (для описания)
```

## Безопасность
- Проверка авторизации пользователя
- Валидация типов файлов (только изображения)
- Ограничение размера файлов (5 МБ)
- Проверка принадлежности изображений к конкретной задаче
- Логирование изменений в истории задачи

## Интеграция с историей задач
- Все изменения описания логируются в TaskHistory
- Сохраняется старое и новое значение
- Указывается пользователь, сделавший изменение
- Автоматическое обновление dtu (время последнего изменения)

## UI/UX особенности
- Модальное окно на весь экран для удобного редактирования
- Индикаторы загрузки изображений
- Подтверждение при закрытии с несохраненными изменениями
- Темная тема
- Отзывчивый дизайн
- Полноэкранный режим редактора