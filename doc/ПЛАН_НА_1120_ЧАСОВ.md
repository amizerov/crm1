# План работ (WBS) по созданию системы управления проектами — 1120 часов

Документ описывает перечень работ и оценку трудозатрат для разработки системы управления проектами уровня CRM/TMS (компании/проекты/задачи/документы/медиатека/секреты) на стеке **Next.js (App Router) + TypeScript + MSSQL + Server Actions**.

## Допущения

- Оценка в человеко‑часах включает: разработку, ревью, локальную отладку, базовую документацию по фичам.
- Не включает: закупки/лицензии, интеграции со сторонними ERP/1C, мобильное приложение, сложные BI‑отчёты.
- Команда может быть 2–4 человека (например: 1–2 full‑stack + QA/PM по доле времени). При другой комплектации календарные сроки меняются, сумма часов — нет.

## Итог по этапам

| Этап | Название | Часы |
| ---: | --- | ---: |
| 0 | Управление проектом и аналитика | 90 |
| 1 | Архитектура, инфраструктура, каркас приложения | 100 |
| 2 | База данных: модель, миграции, индексы, доступ | 110 |
| 3 | Пользователи, авторизация, роли, приглашения, сессии | 120 |
| 4 | Компании/сотрудники/клиенты/проекты (базовый контур) | 110 |
| 5 | Задачи: ядро + табличное представление + настройки | 190 |
| 6 | Представления задач и панель деталей (Desk/Inbox/Gantt/Actions) | 120 |
| 7 | Файлы: документы + медиатека (изображения) | 100 |
| 8 | Усиление безопасности (файлы/XSS/rate limit/TLS) | 60 |
| 9 | Тестирование, стабилизация, документация, релиз | 120 |
| | **ИТОГО** | **1120** |

---

## 0. Управление проектом и аналитика — 90 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 0.1 | Старт проекта: цели, границы, критерии успеха | Vision + scope | 12 |
| 0.2 | Воркшопы требований (пользователи/роли/процессы) | Список фич и ограничений | 24 |
| 0.3 | User stories + acceptance criteria | Backlog с AC | 20 |
| 0.4 | План релизов и контрольные точки | Roadmap + milestones | 10 |
| 0.5 | Базовый security baseline (риски/угрозы/политики) | Threat model (лайт) | 8 |
| 0.6 | Оценка, приоритизация, grooming | Приоритизированный backlog | 16 |
| | **Подытог** | | **90** |

## 1. Архитектура, инфраструктура, каркас приложения — 100 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 1.1 | Конвенции репозитория, структура src/app, алиасы, strict TS | Единый стиль проекта | 14 |
| 1.2 | Управление env (dev/prod), шаблоны `.env*` | Повторяемый запуск окружений | 10 |
| 1.3 | CI: typecheck + lint + build (блокирующие) | Контроль качества в сборке | 16 |
| 1.4 | Базовые утилиты ошибок/логирования/обработки 4xx/5xx | Единообразные ответы | 10 |
| 1.5 | Каркас UI: layout, навигация, theme, route groups | Базовая оболочка приложения | 20 |
| 1.6 | Общие UI-компоненты (формы/кнопки/модалки/тосты) | Переиспользуемый UI-слой | 10 |
| 1.7 | Черновой контур деплоя (сборка, конфиг, healthchecks) | Основа для production | 20 |
| | **Подытог** | | **100** |

## 2. База данных: модель, миграции, индексы, доступ — 110 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 2.1 | Проектирование ER-модели (users/companies/projects/tasks/files) | ERD + спецификация полей | 20 |
| 2.2 | SQL-скрипты создания/изменения таблиц (миграции в /sql) | Набор миграций | 40 |
| 2.3 | Ограничения, FK, уникальности, базовые индексы | Целостность данных | 15 |
| 2.4 | Скрипты тестовых данных и проверок (smoke SQL) | Быстрая проверка на стенде | 10 |
| 2.5 | Слой доступа к MSSQL (параметризация, типизация) | Безопасные query helper’ы | 15 |
| 2.6 | Регламент бэкапов/восстановления для dev/stage | Инструкция + команды | 10 |
| | **Подытог** | | **110** |

## 3. Пользователи, авторизация, роли, приглашения, сессии — 120 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 3.1 | Регистрация + email verification (токены/страницы/письма) | Поток /register → /verify | 25 |
| 3.2 | Вход/выход + сессии (iron-session), middleware guards | Безопасная авторизация | 25 |
| 3.3 | Пароли: bcrypt + миграция легаси при входе | Уход от plain‑text | 20 |
| 3.4 | Роутинг auth-группы, UX для ошибок/редиректов | Чистые URL и UX | 15 |
| 3.5 | Приглашения: создание/принятие + регистрация по инвайту | Онбординг сотрудников | 25 |
| 3.6 | RBAC-хелперы (Partner/Employee) + проверки доступа к компании | Централизованные проверки | 10 |
| | **Подытог** | | **120** |

## 4. Компании/сотрудники/клиенты/проекты (базовый контур) — 110 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 4.1 | Компании: базовые CRUD/просмотр/выбор активной компании | Управление компаниями | 25 |
| 4.2 | Сотрудники: список, приглашения, управление статусом | Командная работа | 20 |
| 4.3 | Клиенты: CRUD + привязка к компании | Реестр клиентов | 20 |
| 4.4 | Проекты: CRUD + связи company/client + список/поиск | Реестр проектов | 25 |
| 4.5 | Карточка проекта: табы (обзор/задачи/документы/медиа/секреты) | Единое место работы с проектом | 20 |
| | **Подытог** | | **110** |

## 5. Задачи: ядро + табличное представление + настройки — 190 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 5.1 | Модель задач (статусы/приоритеты/исполнители/даты/связи) | Единый контракт Task | 25 |
| 5.2 | CRUD задач (Server Actions), валидации, ошибки | Создание/обновление/удаление | 30 |
| 5.3 | Таблица задач: колонки, сортировка, пагинация, состояния | Основной рабочий экран | 45 |
| 5.4 | Фильтры: статус/приоритет/исполнитель/проект/компания | Управляемая выборка | 25 |
| 5.5 | Подзадачи/иерархия + порядок в статусе (orderInStatus) | Управление структурой | 25 |
| 5.6 | Настройки таблицы: localStorage + синк с сервером | Персонализация UI | 20 |
| 5.7 | Оптимизация запросов (EXPLAIN/индексы/батчинг) | Быстрые списки | 20 |
| | **Подытог** | | **190** |

## 6. Представления задач и панель деталей (Desk/Inbox/Gantt/Actions) — 120 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 6.1 | Kanban Desk view: layout, колонки, fullscreen toggle | Канбан-доска | 32 |
| 6.2 | Kanban интерактив: выбор карточки, обновление статуса, UX | Управление задачей с доски | 18 |
| 6.3 | Inbox view: список “назначено мне”, группировка по датам | Экран «Входящие» | 15 |
| 6.4 | Панель деталей задачи: вкладки, формы, загрузка данных | Детальный просмотр | 17 |
| 6.5 | Actions внутри задачи: чеклист + история (интеграция UI/данных) | Исполнение и аудит | 25 |
| 6.6 | Gantt view: диаграмма по задачам проекта, масштаб/период, базовые взаимодействия | Представление «Диаграмма Ганта» | 13 |
| | **Подытог** | | **120** |

## 7. Файлы: документы + медиатека (изображения) — 100 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 7.1 | Документы проекта/задачи: upload/view/download/delete | Полный цикл документов | 30 |
| 7.2 | Скан файловой системы + режим «FS vs DB» | Контроль фактических файлов | 20 |
| 7.3 | Медиатека: список/удаление изображений (Server Actions) | Управление изображениями проекта | 15 |
| 7.4 | Загрузка изображения + вставка в Tiptap (позиция курсора) | Удобный контент‑редактор | 20 |
| 7.5 | Политика хранения: имена, структура папок, базовые лимиты | Предсказуемое хранение | 15 |
| | **Подытог** | | **100** |

## 8. Усиление безопасности (файлы/XSS/rate limit/TLS) — 60 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 8.1 | Комплексная валидация загрузок (magic bytes, расширения, traversal) | Защита от RCE/обходов | 20 |
| 8.2 | XSS-аудит отображения rich content + настройка CSP заголовков | Снижение XSS рисков | 15 |
| 8.3 | Rate limiting для логина/мастер‑пароля (bruteforce) | Защита от перебора | 10 |
| 8.4 | TLS для MSSQL в production (encrypt, cert policy) | Защита канала БД | 5 |
| 8.5 | Security audit logs (что/кто/когда) и чистка опасных логов | Аудит и мониторинг | 10 |
| | **Подытог** | | **60** |

## 9. Тестирование, стабилизация, документация, релиз — 120 ч

| Код | Работа | Результат | Часы |
| --- | --- | --- | ---: |
| 9.1 | Тест‑план, чек‑листы регресса, матрица ролей | Контроль качества | 20 |
| 9.2 | Тесты критичных server actions (auth/files/tasks) | Минимальная автоматика | 35 |
| 9.3 | E2E smoke-набор (Playwright) для ключевых сценариев | Автопроверка релиза | 25 |
| 9.4 | Стабилизация: багфикс‑спринт, UX‑полировка, устранение техдолга | Готовность к эксплуатации | 25 |
| 9.5 | Документация: инструкции админа/пользователя + релиз‑ноты | Передача в эксплуатацию | 15 |
| | **Подытог** | | **120** |

---

## Рекомендуемая нарезка по спринтам (пример)

- 7 спринтов по 2 недели (или эквивалент по мощности команды).
- Каждый спринт: 1) фича‑пакет, 2) security/quality задачи, 3) стабилизация.

## Контрольные результаты (Definition of Done)

- Ключевые сценарии выполняются: регистрация/логин, приглашение, создание проекта, работа с задачами (таблица/канбан/входящие/Гант), документы/медиатека, история/чеклист.
- Ошибки TS/Eslint блокируют сборку (не отключаем strict проверки).
- Все критичные операции имеют проверки доступа (company/project/task).
- Загрузки файлов валидируются по содержимому/размеру/пути.
